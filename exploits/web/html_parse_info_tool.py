from typing import Type, Any

from crewai_tools import BaseTool
from pydantic.v1 import BaseModel, Field
from config import logger
from helpers.html_information_leak_analyze import analyze


class HtmlInformationLeakAnalyzeToolSchema(BaseModel):
    """HtmlInformationLeakAnalyzeToolSchema 的查询参数"""
    html: str = Field(..., description="html源代码")


class HtmlInformationLeakAnalyzeTool(BaseTool):
    name: str = "HtmlInformationLeakAnalyze"
    description: str = "从html源代码中得到潜在的敏感信息"
    args_schema: Type[BaseModel] = HtmlInformationLeakAnalyzeToolSchema

    def __init__(self, ):
        super().__init__()
        logger.info("初始化工具 HtmlInformationLeakAnalyze")

    def _run(
            self,
            **kwargs: Any,
    ) -> Any:
        html = kwargs.pop('html', "")
        if html == "":
            return "html为空"
        datas = analyze(html)

        if datas == "":
            return "未找到任何信息"

        return datas
